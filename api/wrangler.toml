# ================================
# wrangler.toml
# ================================

name = "saas-api"                  # 本番 Worker 名
main = "src/index.ts"
compatibility_date = "2024-10-01"
workers_dev = true
minify = true

# Cloudflare アカウント
account_id = "0d18eef52ba66f8cddcf260265d14cf4"

# ===== 本番の環境変数（秘密以外） =====
[vars]
BASE_URL = "https://saas-api.hekuijincun.workers.dev"
# 管理者ユーザーID（複数可: カンマ区切り）
ADMINS   = "U929e7fcc7a5ed0c4cbcd0c4c9b001815"

# ※ 秘密情報（LINE_CHANNEL_*）は wrangler secret または
#    Cloudflare ダッシュボードで設定。

# === KV（本番とプレビュー共通） ===
[[kv_namespaces]]
binding    = "LINE_BOOKING"
id         = "22103efd0bd04365a2ec050a24b3dbc4"
preview_id = "03bbf9082957456cb4c18159d6788808"

# === Durable Object バインド ===
[[durable_objects.bindings]]
name = "SLOT_LOCK"
class_name = "SlotLock"

# ※重要※ 既に DO を作成済みのため、migrations は書かない（再適用による 10074 回避）

# ======== staging 環境 ========
[env.staging]
name = "saas-api-staging"          # ステージングは別名
account_id = "0d18eef52ba66f8cddcf260265d14cf4"
main = "src/index.ts"
workers_dev = true

# staging 用の KV/DO バインド（本番と同一リソースを参照）
[[env.staging.kv_namespaces]]
binding    = "LINE_BOOKING"
id         = "22103efd0bd04365a2ec050a24b3dbc4"
preview_id = "03bbf9082957456cb4c18159d6788808"

[[env.staging.durable_objects.bindings]]
name = "SLOT_LOCK"
class_name = "SlotLock"

# staging の環境変数（秘密以外）
[env.staging.vars]
BASE_URL = "https://saas-api-staging.hekuijincun.workers.dev"
ADMINS   = "U929e7fcc7a5ed0c4cbcd0c4c9b001815"
